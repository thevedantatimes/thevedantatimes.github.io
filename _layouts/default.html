<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon.png">
  </head>
  <body class="{% if page.url == '/' %}is-home{% endif %}">
    <a class="skip" href="#content">Skip to content</a>

    <header class="masthead">
      <div class="mast-top">
        <div class="mast-left">
          <div class="mast-date">{{ site.time | date: '%A, %B %-d, %Y' }}</div>
          <div class="mast-sub">Today's Paper</div>
        </div>

        <div class="mast-logo" aria-label="{{ site.title }}">
          <a href="{{ '/' | relative_url }}" class="logo">{{ site.title }}</a>
        </div>

        <div class="mast-right">
          {% if page.url == '/' %}
            <div class="mast-events" id="mastEvents" aria-label="Upcoming events">
              <div class="mast-events-kicker">Upcoming</div>
              <div class="mast-events-title" data-me-title>Upcoming event</div>
              <div class="mast-events-when" data-me-when></div>
            </div>
          {% else %}
            <div class="mast-market"><span class="muted">Market</span> <span class="pos">+0.6%</span> <span class="arrow">↑</span></div>
            <div class="mast-mini">Dow</div>
          {% endif %}
        </div>
      </div>

      <nav class="nav" aria-label="Primary">
        <a href="{{ '/' | relative_url }}" class="nav-item">Home</a>

        <div class="nav-dd">
          <button class="nav-item nav-dd-btn" type="button" aria-haspopup="true">
            Categories <span class="nav-caret" aria-hidden="true">▾</span>
          </button>
          <div class="nav-dd-menu" role="menu" aria-label="Categories">
            <a role="menuitem" href="{{ '/category/' | relative_url }}">All categories</a>
            <div class="nav-dd-rule" aria-hidden="true"></div>
            {% assign cats = site.categories | sort %}
            {% for c in cats %}
              {% assign name = c[0] %}
              <a role="menuitem" href="{{ '/category/' | relative_url }}?c={{ name | url_encode }}">                <span class="nav-dd-label">{{ name }}</span>                <span class="nav-dd-count">({{ c[1] | size }})</span>              </a>
            {% endfor %}
          </div>
        </div>

        <a href="/events" class="nav-item">Events</a>
        <a href="/donate" class="nav-item">Donate</a>

        <div class="nav-dd">
          <button class="nav-item nav-dd-btn" type="button" aria-haspopup="true">
            More <span class="nav-caret" aria-hidden="true">▾</span>
          </button>
          <div class="nav-dd-menu" role="menu" aria-label="More">
            <a role="menuitem" href="/about">About</a>
            <a role="menuitem" href="/contact">Submit a story</a>
            <a role="menuitem" href="/contact">Contact</a>
          </div>
        </div>
      </nav>

      <div class="mast-rules" aria-hidden="true"></div>
    </header>

    <main id="content" class="page">
      {{ content }}
    </main>

    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-title">{{ site.title }}</div>
        <div class="footer-meta">© {{ site.time | date: '%Y' }}. All rights reserved.</div>
      </div>
    </footer>
    <script>
      window.VTT_HOME_YT_CHANNELS = {{ site.home_youtube_channels | default: nil | jsonify }};
      window.VTT_POSTS_INDEX_URL = "{{ '/assets/data/posts_index.json' | relative_url }}";

      // Home-only: Upcoming events ticker (edit this list to maintain your events)
      window.VTT_UPCOMING_EVENTS = [
        { title: 'Saraswati Puja', when: '14 Feb 8 PM IST', iso: '2026-02-14T20:00:00+05:30' },
        { title: 'Shivaratri', when: '26 Feb 7 PM IST', iso: '2026-02-26T19:00:00+05:30' },
        { title: 'Rama Navami', when: '29 Mar 8 PM IST', iso: '2026-03-29T20:00:00+05:30' }
      ];
    </script>
    <script defer src="{{ '/assets/js/youtube_widget.js' | relative_url }}"></script>
<script defer src="{{ '/assets/js/post_enhancements.js' | relative_url }}"></script>
    <script>
    (() => {
      const dds = Array.from(document.querySelectorAll('.nav-dd'));
      if (!dds.length) return;

      function closeAll(except){
        dds.forEach(dd => { if (dd !== except) dd.classList.remove('open'); });
      }

      dds.forEach(dd => {
        const btn = dd.querySelector('.nav-dd-btn');
        if (!btn) return;
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const willOpen = !dd.classList.contains('open');
          closeAll(dd);
          dd.classList.toggle('open', willOpen);
        });
      });

      document.addEventListener('click', (e) => {
        if (!dds.some(dd => dd.contains(e.target))) closeAll(null);
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeAll(null);
      });
    })();
    </script>

    <script>
    (function(){
      var box = document.getElementById('mastEvents');
      if (!box) return;

      var titleEl = box.querySelector('[data-me-title]');
      var whenEl = box.querySelector('[data-me-when]');
      var data = Array.isArray(window.VTT_UPCOMING_EVENTS) ? window.VTT_UPCOMING_EVENTS : [];

      function parseIso(iso){
        try {
          var t = new Date(String(iso || '')).getTime();
          return isNaN(t) ? 0 : t;
        } catch (e) {
          return 0;
        }
      }

      function getUpcoming(){
        var now = Date.now();
        var up = data
          .map(function(e){
            return {
              title: String((e && e.title) || ''),
              when: String((e && e.when) || ''),
              iso: String((e && e.iso) || ''),
              _t: parseIso(e && e.iso)
            };
          })
          .filter(function(e){ return e._t && e._t > now; });

        up.sort(function(a,b){ return a._t - b._t; });
        return up;
      }

      var rot = [];
      var idx = 0;

      function setContent(e){
        if (!titleEl || !whenEl) return;
        titleEl.textContent = e && e.title ? e.title : 'No upcoming events';
        whenEl.textContent = e && e.when ? e.when : '';
      }

      function fadeTo(e){
        box.classList.add('me-fade');
        window.setTimeout(function(){
          setContent(e);
          box.classList.remove('me-fade');
        }, 240);
      }

      function refresh(){
        rot = getUpcoming().slice(0,2);
        if (!rot.length) {
          idx = 0;
          setContent(null);
          return;
        }
        idx = 0;
        setContent(rot[0]);
      }

      refresh();

      window.setInterval(function(){
        rot = getUpcoming().slice(0,2);
        if (!rot.length) {
          idx = 0;
          fadeTo(null);
          return;
        }
        if (rot.length === 1) {
          idx = 0;
          fadeTo(rot[0]);
          return;
        }
        idx = (idx + 1) % 2;
        fadeTo(rot[idx]);
      }, 15000);

      // Re-evaluate the list periodically (in case an event just passed)
      window.setInterval(function(){
        refresh();
      }, 60000);
    })();
    </script>

  </body>
</html>
