{%- comment -%}
  Returns a best-effort YouTube thumbnail URL derived from a post/page HTML content.

  Usage:
    {% capture thumb %}{% include youtube_thumbnail.html content=page.content %}{% endcapture %}

  If no YouTube embed/link is found, falls back to /assets/img/default.webp
{%- endcomment -%}

{%- assign c = include.content | default: '' -%}
{%- assign fallback = '/assets/img/default.webp' -%}
{%- assign video_id = '' -%}

{%- if c contains 'youtube.com/embed/' -%}
  {%- assign parts = c | split: 'youtube.com/embed/' -%}
  {%- if parts.size > 1 -%}
    {%- assign after = parts[1] -%}
    {%- assign video_id = after | split: '?' | first | split: '&' | first | split: '"' | first | split: "'" | first | split: '<' | first | split: '>' | first | split: '/' | first | strip -%}
  {%- endif -%}
{%- elsif c contains 'youtube-nocookie.com/embed/' -%}
  {%- assign parts = c | split: 'youtube-nocookie.com/embed/' -%}
  {%- if parts.size > 1 -%}
    {%- assign after = parts[1] -%}
    {%- assign video_id = after | split: '?' | first | split: '&' | first | split: '"' | first | split: "'" | first | split: '<' | first | split: '>' | first | split: '/' | first | strip -%}
  {%- endif -%}
{%- elsif c contains 'youtu.be/' -%}
  {%- assign parts = c | split: 'youtu.be/' -%}
  {%- if parts.size > 1 -%}
    {%- assign after = parts[1] -%}
    {%- assign video_id = after | split: '?' | first | split: '&' | first | split: '"' | first | split: "'" | first | split: '<' | first | split: '>' | first | split: '/' | first | strip -%}
  {%- endif -%}
{%- elsif c contains 'watch?v=' -%}
  {%- assign parts = c | split: 'watch?v=' -%}
  {%- if parts.size > 1 -%}
    {%- assign after = parts[1] -%}
    {%- assign video_id = after | split: '&' | first | split: '"' | first | split: "'" | first | split: '<' | first | split: '>' | first | split: '/' | first | strip -%}
  {%- endif -%}
{%- endif -%}

{%- if video_id and video_id != '' -%}
https://i.ytimg.com/vi/{{ video_id }}/hqdefault.jpg
{%- else -%}
{{ fallback }}
{%- endif -%}
